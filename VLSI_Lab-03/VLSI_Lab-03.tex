\documentclass[a4paper, 12pt]{article}
\usepackage[UTF8]{ctex} 
\usepackage{geometry} 
\usepackage{enumitem} 
\usepackage{titlesec} 
\usepackage{xcolor} 
\usepackage{ulem} 
\usepackage{graphicx} 
\usepackage{float} 
\usepackage{amsmath} 
\usepackage{subcaption}
\usepackage{circuitikz}
\usepackage{hyperref} 
\usepackage{fancyhdr}

\geometry{left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm}

% 设置行距
\linespread{1.5}

% 设置段落间距
\setlength{\parskip}{0.5em}

\titleformat{\section}{\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\large\bfseries}{\thesubsection}{1em}{}

\setlist[enumerate,1]{label=\arabic*、, leftmargin=*}
\setlist[enumerate,2]{label=\arabic*., leftmargin=*}

% XeLaTeX下使用系统字体
\setCJKmainfont{SimSun}[AutoFakeBold=2.5] % 宋体
\setCJKsansfont{SimHei} % 黑体
\setCJKmonofont{FangSong} % 仿宋
\setCJKfamilyfont{kai}{KaiTi} % 楷体
\newcommand{\kai}{\CJKfamily{kai}}

% 配置hyperref
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=blue,
    citecolor=blue
}

\begin{document}

% 标题
\begin{center}
    {\kai\LARGE\textbf{实验三\ \ 逻辑门的功耗优化及EDP优化}}
\end{center}

% 页眉页脚
\pagestyle{fancy}
\fancyhf{} 
\fancyhead[L]{\kai 实验三\ \ 逻辑门的功耗优化及EDP优化} % 左侧页眉
\fancyhead[R]{\href{https://github.com/yuchihatuntun/SYSU-MST-VLSI_Lab}{GitHub} | 23342107\ 徐睿琳}                   % 右侧页眉
\fancyfoot[C]{\thepage}                       % 页脚居中页码
\renewcommand{\headrulewidth}{0.4pt}          % 页眉线宽度
\renewcommand{\footrulewidth}{0pt}            % 页脚线宽度

\begin{center}
    23342107\ 徐睿琳
\end{center}

\vspace{0.5cm}

% 实验要求
\section*{一、实验要求}

了解动态功耗的影响因素，掌握CMOS逻辑门的动态功耗优化。

% 实验目的
\section*{二、实验目的}

\begin{enumerate}
    \item 了解NAND门的搭建方法；
    \item 了解延迟的定义及计算方法；
    \item 掌握如何得到最小延时
\end{enumerate}

% 实验内容
\section*{三、实验内容}
\begin{enumerate}
    \item 针对指定逻辑门，通过仿真波形或电路图分析，写出其逻辑表达式，并计算其在 100ns 内的能耗；
        
    \item 设计并实现与实验 A）中逻辑功能相同的电路，命名为 lab3\_mycell，要求其能耗-延时积（EDP）小于实验 A）中的逻辑门。输入信号的占空比分别为：A：0.7，B：0.5，C：0.2，D：0.1。

\end{enumerate}

% 实验步骤
\section*{四、实验步骤}

\subsection*{4.1\ \texttt{lab3\_a} 逻辑分析与能耗计算}

\begin{figure}[H]\centering
	\includegraphics[width=0.8\columnwidth]{assets/1.png}
	\caption{\texttt{lab3\_a} 测试电路图}
	\label{fig:lab3_a_test_circuit}
\end{figure}

首先，结合 \texttt{lab3\_a} 的测试电路图与仿真波形，分析输入信号 A、B、C、D 的连接方式及其对输出 Y 的影响。通过观察 100ns 内各输入组合对应的输出变化，归纳输出 Y 的逻辑表达式。最后，统计 100ns 内的能耗数据，为后续电路优化和 EDP 比较提供依据。

\subsection*{4.2\ \texttt{lab3\_mycell} 设计与功耗综合优化}

在设计初期，我们对基准电路 lab3\_a（基于 4 输入或 8 输入 NAND 门直连反相器）的局限性进行分析：

\subsubsection*{\texttt{lab3\_a} 电路设计分析}

\begin{figure}[H]\centering
	\includegraphics[width=0.6\columnwidth]{assets/4.png}
	\caption{\texttt{lab3\_a} 电路图}
	\label{fig:lab3_a_circuit}
\end{figure}

大扇入 NAND 门存在严重的堆叠效应，为平衡 $N$ 管串联带来的导通电阻，必须将 NMOS 尺寸放大 $N$ 倍。

\textbf{EDP 瓶颈}：

\begin{itemize}
	\item \textbf{延时（$D$）}：串联管导致巨大的寄生延时（$P \propto N$），导致本征速度极慢。
	\item \textbf{能耗（$E$）}：为了补偿速度而被迫增大的晶体管尺寸，带来了巨大的栅极电容和扩散电容，导致动态功耗激增。
\end{itemize}

为了找到能耗延时积最小的结构，我尝试了三种替代\texttt{lab3\_a}逻辑实现方式：

\subsubsection*{并行树形结构 (\texttt{lab3\_mycell\_01})}

\textbf{设计思路}：利用 De Morgan 定律，我将 AND4 分解为两级逻辑：\texttt{NAND2 // NAND2 -> NOR2}，将关键路径上晶体管的\textbf{最大堆叠高度}从 4 管串联降低至 2 管串联。

\begin{figure}[H]\centering
	\includegraphics[width=0.6\columnwidth]{assets/5.png}
	\caption{\texttt{lab3\_mycell\_01} 电路图}
	\label{fig:lab3_mycell_01_circuit}
\end{figure}

降低能耗延时积 (EDP) 的首要手段是降低寄生参数，而非盲目增大驱动。

\begin{enumerate}
	\item \textbf{打断串联链}：利用 De Morgan 定律将 4 管串联（或 8 管串联）分解为多级逻辑。优势在于 mycell\_01 中最大的串联数仅为 2（NAND2 或 NOR2），相比于基准电路，其寄生延时（$P$）减半。
	\item \textbf{降低无效电容 (Reducing $C$)}：由于串联数减少，NAND2 的 NMOS 只需放大 2 倍即可平衡电阻。意味着更小的栅电容和内部节点电容。直接降低了每一次翻转所需的电荷量（$Q$），从而降低能耗（$E$）。
\end{enumerate}

\paragraph{参数扫描设计}

由于工艺最小宽度为 120 nm，故参数 a 的理论下限为 120/330 ≈ 0.36（此处取 0.4），参数 o 的理论下限为 120/280 ≈ 0.43（此处取 0.5）。

对 a 与 o 进行粗略参数扫描，共设 36 个取样点：

\begin{figure}[H]\centering
	\begin{subfigure}{0.5\columnwidth}
		\centering
		\includegraphics[width=0.85\linewidth]{assets/8.png}
		\caption{lab3\_mycell\_nand2参数}
		\label{fig:nand2_params}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.48\columnwidth}
		\centering
		\includegraphics[width=\linewidth]{assets/9.png}
		\caption{lab3\_mycell\_nor2参数}
		\label{fig:nor2_params}
	\end{subfigure}
	\caption{参数扫描设计}
	\label{fig:parameter_sweep_design}
\end{figure}

\begin{figure}[H]\centering
	\includegraphics[width=1\columnwidth]{assets/10.png}
	\caption{36步参数扫描设置}
	\label{fig:parameter_sweep_setup}
\end{figure}

\subsubsection*{驱动能力权衡，引入链式结构(lab3\_mycell\_02)}

在仿真 mycell01 后，我发现树形结构虽然本征性能优异，但在驱动 64 倍大负载 时显得力不从心。最后一级 NOR2 需要做得非常大才能驱动负载。因此，我尝试了 \texttt{lab3\_mycell\_02}（NAND2-INV 组合的链式结构）。

\textbf{局限性分析}：虽然驱动力改善了，但级数过多增加了总的开关活动率，可能导致能耗回升。

\begin{figure}[H]\centering
	\includegraphics[width=1\columnwidth]{assets/6.png}
	\caption{\texttt{lab3\_mycell\_02} 电路图}
	\label{fig:lab3_mycell_02_circuit}
\end{figure}

\subsubsection*{\texttt{lab3\_mycell\_03} 电路设计(基于\texttt{lab3\_b}实现)}

\begin{figure}[H]\centering
	\includegraphics[width=1\columnwidth]{assets/7.png}
	\caption{\texttt{lab3\_mycell\_03} 电路图}
	\label{fig:lab3_mycell_03_circuit}
\end{figure}

% 实验结果
\section*{五、实验结果}

\subsection*{5.1\ \texttt{lab3\_a} 逻辑分析与能耗计算}

\subsubsection{逻辑分析}

\begin{figure}[H]\centering
	\includegraphics[width=0.9\columnwidth]{assets/2.png}
	\caption{\texttt{lab3\_a} 100ns 内仿真波形图}
	\label{fig:lab3_a_simulation_waveform}
\end{figure}

如图\ref{fig:lab3_a_simulation_waveform}所示，通过观察波形图可知，输出 Y 的逻辑表达式为：

\[
Y = A \cdot B \cdot C \cdot D
\]

即\texttt{lab3\_a}是一个四输入与门。

\subsubsection{能耗计算}

根据\texttt{(abs(integ(i("/V5/PLUS" ?result "tran") 0 1e-07)) * 1.1)}计算，在 100ns 内，\texttt{lab3\_a} 的能耗为：

\begin{figure}[H]\centering
	\includegraphics[width=0.8\columnwidth]{assets/3.png}
	\caption{\texttt{lab3\_a} 100ns 内能耗计算结果}
	\label{fig:lab3_a_energy_consumption}
\end{figure}

% 总结
\section*{六、总结}

% 附录
\section*{附录}
\appendix
\renewcommand{\thesection}{附录\Alph{section}}

\section{相关代码}

\section{数据表格}

\section{其他材料}

\end{document}